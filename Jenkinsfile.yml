pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                script {
                    sh 'python3 -m venv shuup-venv'  // Create a virtual environment
                    sh 'shuup-venv\\Scripts\\activatee'  // Activate the virtual environment
                    sh 'pip install -r requirements.txt'  // Install project dependencies

                    sh 'python manage.py migrate'  // Example Django migration command
                }
            }
        }
        
        stage('Test') {
            steps {
                script {
                    sh 'python -m venv venv'  // Create a virtual environment
                    sh 'venv\\Scripts\\activate'  // Activate the virtual environment (Windows)
                    sh 'pip install -r requirements.txt'  // Install project dependencies for testing

                    sh 'python manage.py test'  // Example command for running tests with Django
                }
            }
        }

        stage('Deploy') {
            steps {
                script {
                    sh 'python -m venv new-venv'  // Create a virtual environment
                    sh 'new-venv\\Scripts\\activate'  // Activate the virtual environment (Windows)
                    sh 'pip install -r requirements.txt'  // Install project dependencies for deployment

                    sh 'python manage.py collectstatic --noinput'  // Collect static files
                    sh 'gunicorn shuup.wsgi:application'  // Example command for running Gunicorn server
                }
            }
        }
    }
}
